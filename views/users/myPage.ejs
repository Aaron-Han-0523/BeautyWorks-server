<!DOCTYPE html>
<html lang="ko">

<head>
  <%- include ("../partials/header.ejs") %>
</head>

<body class="layout-boxed">

  <%- include ("../partials/loader.ejs") %>

  <%- include ("../partials/client-nav.ejs") %>

  <!--  BEGIN MAIN CONTAINER  -->
  <div class="main-container" id="container">

    <div class="overlay"></div>
    <div class="search-overlay"></div>
    <%- include ("../partials/client-sidebar.ejs", {user:user}) %>

    <!--  BEGIN CONTENT AREA  -->
    <div id="content" class="main-content">
      <div class="layout-px-spacing">

        <div class="middle-content  p-0">

          <!-- BREADCRUMB -->
          <div class="row px-3 mt-3">
            <div class="breadcrumb">
              <div class="p-1">
                <div class="menu">
                  <%= __('MyPage') %>
                </div>
              </div>
              <div class="p-1 flex-grow-1">
                <a href="<%= codezip.url.users.myAccount %>" class="text-primary sidebar-theme px-1 br-4">
                  <i class="fa-solid fa-angle-down"></i>
                </a>
              </div>
              <a href="<%= codezip.url.users.signOut %>">
                <div class="sidebar-theme br-5 py-2 px-3">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" stroke="currentColor" width="24px" height="24px" stroke-width="2" stroke-linecap="round" viewBox="0 0 76 85">
                    <path d=" M4.116826,78.265404   C4.013828,55.503761 4.004358,33.174091 4.001761,10.844418   C4.001094,5.110954 5.633172,3.164078 11.493685,3.054947   C21.821774,2.862622 32.168144,2.702272 42.482834,3.120762   C48.066319,3.347296 50.111496,4.964166 50.024464,10.953341   C49.920639,18.097635 49.999989,25.244595 49.999989,32.757912   C48.379898,32.856651 46.978878,32.942039 44.999851,33.062656   C44.999851,26.376459 44.834988,19.922174 45.064762,13.481969   C45.192432,9.903473 43.832859,8.870009 40.404411,8.939007   C31.409502,9.120029 22.407000,9.094803 13.410821,8.948723   C10.272186,8.897758 8.923581,9.773623 8.943764,13.164448   C9.059805,32.660618 9.052705,52.158115 8.947888,71.654411   C8.930679,74.855194 9.904271,76.115456 13.229795,76.056175   C22.392075,75.892853 31.560974,75.895958 40.723400,76.055168   C43.999668,76.112099 45.147400,74.955482 45.053230,71.699997   C44.870495,65.382965 44.999775,59.056904 44.999775,52.369476   C46.643154,52.369476 48.139885,52.369476 49.998058,52.369476   C49.998058,60.263142 50.100910,68.066177 49.959629,75.864799   C49.874367,80.571159 45.989986,81.757523 42.545216,81.873688   C32.225281,82.221680 21.878883,82.206718 11.559663,81.848320   C9.077263,81.762108 6.660084,79.797905 4.116826,78.265404  z" />
                    <path d=" M59.014618,26.045418   C61.348267,27.193729 63.484882,28.141630 65.157600,29.615877   C67.892479,32.026257 70.339447,34.765663 72.881897,37.391415   C75.979965,40.590984 76.047028,44.575195 72.781273,47.673988   C68.716423,51.531021 64.464005,55.191494 60.245110,58.882576   C59.964554,59.128029 59.282509,58.914581 57.212154,58.914581   C58.536896,56.183857 59.391861,53.891689 60.689957,51.886368   C62.151241,49.628956 64.011978,47.630116 66.067307,45.057789   C50.499809,45.057789 35.586002,45.057789 20.322596,45.057789   C20.176996,43.435238 20.051184,42.033199 19.889898,40.235855   C35.192932,40.235855 50.269775,40.235855 66.303703,40.235855   C63.861748,37.226780 61.647526,35.077080 60.184765,32.500732   C59.138016,30.657087 59.098286,28.241688 59.014618,26.045418  z" />
                  </svg>
                  <span><%= __('Log out') %></span>
                </div>
              </a>
            </div>
          </div>

          <!-- CONTENT AREA -->
          <div class="row mt-3">
            <div class="col-xl-12 col-lg-12 col-sm-12  layout-spacing">

              <!-- 내가 찜한 내용물 -->
              <div class="widget-content widget-content-area br-20 px-4 mt-3">
                <div class="form-group ms-3">
                  <div class="row mb-3">
                    <div class="justify-content-between d-flex px-0">
                      <div>
                        <h4><strong>
                            <%= __("users.myPage.header.내가찜한내용물") %>
                          </strong>
                          </h5>
                      </div>
                    </div>
                  </div>

                  <div class="row">
                    <div class="widget pt-5 pb-0 row mx-0" id="wishList">

                    </div>
                  </div>
                </div>
              </div>

              <!-- 내가 작성한 게시글 -->
              <div class="widget-content widget-content-area br-20 px-4 mt-5">
                <div class="form-group ms-3">
                  <div class="row mb-3">
                    <div class="justify-content-between d-flex px-0">
                      <div>
                        <h4><strong>
                            <%= __("users.myPage.header.내가작성한게시글") %>
                          </strong>
                          </h5>
                      </div>
                    </div>
                  </div>

                  <div class="row mt-3">

                    <div class="widget w-100">
                      <div class="form-group mx-3">

                        <!-- list -->
                        <div class="row mt-3">
                          <div class="text-black align-self-center">
                            <div class="d-flex form-control text-center h6 p-0 m-0 pe-3">
                              <div class="col-1 py-3">
                                <%= __('users.myPage.table.thead.number') %>
                              </div>
                              <div class="col-6 py-3">
                                <%= __('users.myPage.table.thead.title') %>
                              </div>
                              <div class="col-2 py-3">
                                <%= __('users.myPage.table.thead.date') %>
                              </div>
                              <div class="col-3 py-3">
                                <%= __('users.myPage.table.thead.writer') %>
                              </div>
                            </div>
                            <div id="myPosts">

                            </div>
                          </div>
                        </div>

                        <!-- pagination -->
                        <div id="myPosts_pagination"></div>

                      </div>
                    </div>

                  </div>
                </div>
              </div>

              <!-- 내가 좋아하는 게시글 & 내가 좋아하는 댓글 -->
              <div class="row mt-5">
                <!-- 내가 좋아하는 게시글 -->
                <div class="col-6 pe-4">
                  <div class="widget-content widget-content-area p-0 ps-4 h-100 d-flex flex-column">

                    <div class="justify-content-between d-flex px-0 mb-3">
                      <div>
                        <h4><strong>
                            <%= __('users.myPage.header.내가좋아하는게시글') %>
                          </strong>
                          </h5>
                      </div>
                    </div>

                    <div class="widget row pt-4 mx-0 h-100 align-content-center d-flex flex-column">
                      <div class="form-group">

                        <!-- list -->
                        <div class="row mt-3">
                          <div class="text-black align-self-center">
                            <div class="d-flex form-control text-center h6 p-0 m-0 px-3">
                              <div class="col-4 py-3">
                                <%= __('users.myPage.table.thead.writer') %>
                              </div>
                              <div class="col py-3">
                                <%= __('users.myPage.table.thead.title') %>
                              </div>
                              <div class="col-2 py-3">
                                <%= __('users.myPage.table.thead.date') %>
                              </div>
                            </div>
                            <div id="favoritePosts">

                            </div>
                          </div>
                        </div>

                        <!-- pagination -->
                        <div id="favoritePosts_pagination"></div>

                      </div>
                    </div>
                  </div>
                </div>

                <!-- 내가 좋아하는 댓글 -->
                <div class="col-6 ps-4">
                  <div class="widget-content widget-content-area p-0 pe-3 h-100 d-flex flex-column">
                    <div class="justify-content-between d-flex px-0 mb-3">
                      <div>
                        <h4><strong>
                            <%= __('users.myPage.header.내가좋아하는댓글') %>
                          </strong>
                          </h5>
                      </div>
                    </div>

                    <div class="widget row pt-4 mx-0 h-100 align-content-center d-flex flex-column">
                      <div class="form-group">

                        <!-- list -->
                        <div class="row mt-3">
                          <div class="text-black align-self-center">
                            <div class="d-flex form-control text-center h6 p-0 m-0 px-3">
                              <div class="col-4 py-3">
                                <%= __('users.myPage.table.thead.writer') %>
                              </div>
                              <div class="col py-3">
                                <%= __('users.myPage.table.thead.content') %>
                              </div>
                              <div class="col-2 py-3">
                                <%= __('users.myPage.table.thead.date') %>
                              </div>
                            </div>
                            <div id="favoriteComments">

                            </div>
                          </div>
                        </div>

                        <!-- pagination -->
                        <div id="favoriteComments_pagination"></div>

                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>


          </div>
        </div>
      </div>



      <%- include ("../partials/footer.ejs") %>

    </div>
    <!--  END CONTENT AREA  -->
  </div>
  <!-- END MAIN CONTAINER -->

  <%- include ("../partials/commonScrpits.ejs") %>

  <!-- BEGIN PAGE LEVEL PLUGINS/CUSTOM SCRIPTS -->
  <div>
    <% let category1_name_list=[]; %>
    <% let category2_name_list={} %>
    <% for (let i=0; i < codezip.numberOfProduct.category1; i++) { %>
    <% category1_name_list.push(__('product'+i)); %>
    <% category2_name_list[i]={}; %>
    <% for (let j=0; j < codezip.numberOfProduct.category2[i]; j++) { %>
    <% category2_name_list[i][j]=__('product'+i+'.'+j); %>
    <% } } %>
  </div>
  <script>
    const category1_name_list = JSON.parse('<%- JSON.stringify(category1_name_list) %>');
    const category2_name_list = JSON.parse('<%- JSON.stringify(category2_name_list) %>');
    const top_or_new = ["NEW", "TOP"];
    const badge_new_html = '<span class="me-1 mark mark-outline-new bg-white">New</span>';
    const WrittenBy_text = "<%= __('users.community.index.WrittenBy') %>"
    const locale = "<%= locale %>"
    const nameOrderInKorean = JSON.parse('<%- JSON.stringify(nameOrderInKorean) %>');
  </script>
  <script>
    function load_wishList(page = 1) {
      const url = "<%= codezip.url.users.api.myPage.wishList %>";
      const data = fetch(url + `?p=${page}`)
        .then(res => {
          return res.json();
        }).then(data => {
          // console.log("wishList", data);
          show_wishList(data, page);
        }).catch(err => {
          console.error(err);
        })
    }

    function show_wishList(data, page) {
      console.log(data);
      let temp_html = '';

      data.rows.forEach((item, index) => {
        temp_html += `<div class="col-3 d-flex flex-column">
          <a class="hover" href="/users/formula/${item.id}">
              <div class="preview">`
        if (item.image_paths) {
          temp_html += `<img class="br-10" src="${item.image_paths.split(`,`)[0]}">`
        }
        temp_html += `</div>
              <div class="row mt-3 justify-content-center text-break">
                <p><strong>${top_or_new[item.top_or_new] +' / '+ category1_name_list[item.category1]}</strong></p>
                <p style="color: gray;">
                  ${category2_name_list[item.category1][item.category2]}
                </p>
                <p><strong>${item.product_name}</strong></p>
              </div>
            </a>
            </div>`
      })

      temp_html += make_pagination_by_func(page, data.count, "load_wishList", 4)

      wishList.innerHTML = temp_html;
    }
  </script>
  <script>
    function load_myPosts(page = 1) {
      myPosts
      const url = "<%= codezip.url.users.api.myPage.myPosts %>";
      fetch(url + `?p=${page}`)
        .then(res => {
          return res.json();
        }).then(data => {
          // console.log("myPosts", data);
          show_myPosts(data, page);
        }).catch(err => {
          console.error(err);
        })

    }

    function show_myPosts(data, page) {
      console.log(data);
      let temp_html = '';
      const community_url = '<%= codezip.url.users.community.main %>'

      data.rows.forEach((item, index) => {
        temp_html += `<a class="d-flex border-bottom py-3 page-link text-black ps-0 pe-3" href='${community_url}/${item.id}'>
              <div class="col-1 text-center">${item.id}</div>
              <div class="col text-ellipsis">`
        let day_1_ago = new Date(Date.now() - 1 * 24 * 3600 * 1000);
        if (new Date(item.create_date) > day_1_ago) {
          temp_html += badge_new_html;
        }
        temp_html += `${item.title}
              </div>
              <div class="col-2 text-center text-ellipsis">
                ${formatDate(item.create_date)}
              </div>
              <div class="col-3 text-center text-ellipsis">
                ${WrittenBy_text} `
        if (nameOrderInKorean.indexOf(locale) != -1) {
          temp_html += `${item.last_name} ${item.first_name}`
        } else {
          temp_html += `${item.first_name} ${item.last_name}`
        }
        temp_html += `</div>
            </a>`
      })
      myPosts.innerHTML = temp_html;

      // make_pagination_by_func(page, count, func_name, limit = 10)
      if (data.count > 0) myPosts_pagination.innerHTML = make_pagination_by_func(page, data.count, "load_myPosts", 4)

    }
  </script>
  <script>
    function load_favoritePosts(page = 1) {
      const url = "<%= codezip.url.users.api.myPage.favoritePosts %>";
      fetch(url + `?p=${page}`)
        .then(res => {
          return res.json();
        }).then(data => {
          // console.log("favoritePosts", data);
          show_favoritePosts(data, page);
        }).catch(err => {
          console.error(err);
        })
    }

    function show_favoritePosts(data, page) {
      console.log(data);
      let temp_html = '';
      const community_url = '<%= codezip.url.users.community.main %>'

      data.rows.forEach((item, index) => {
        temp_html += `<a class="d-flex border-bottom py-3 page-link text-black align-items-center px-3" href='${community_url}/${item.id}'>
          <div class="col-4 d-flex align-items-center">
            <div class="profileImage me-1">
              <img alt="avatar" src="${item.profile_image_path}" class="rounded-circle">
            </div>
            <div class="text-ellipsis">`
        if (nameOrderInKorean.indexOf(locale) != -1) {
          temp_html += `${item.last_name} ${item.first_name}`
        } else {
          temp_html += `${item.first_name} ${item.last_name}`
        }
        temp_html += `</div>
          </div>
          <div class="col flex-grow-1 px-3">
            ${item.title}
          </div>
          <div class="col-2 text-center text-ellipsis">
            ${formatDate(item.create_date)}
          </div>
        </a>`
      })

      favoritePosts.innerHTML = temp_html;

      // make_pagination_by_func(page, count, func_name, limit = 10)
      favoritePosts_pagination.innerHTML = make_pagination_by_func(page, data.count, "load_favoritePosts", 4)
    }
  </script>
  <script>
    function load_favoriteComments(page = 1) {
      const url = "<%= codezip.url.users.api.myPage.favoriteComments %>";
      fetch(url + `?p=${page}`)
        .then(res => {
          return res.json();
        }).then(data => {
          // console.log("favoriteComments", data);
          show_favoriteComments(data, page);
        }).catch(err => {
          console.error(err);
        })
    }

    function show_favoriteComments(data, page) {
      console.log(data);
      let temp_html = '';
      const community_url = '<%= codezip.url.users.community.main %>'

      data.rows.forEach((item, index) => {
        temp_html += `<a class="d-flex border-bottom py-3 page-link text-black align-items-center px-3" href='${community_url}/${item.communities_id}'>
              <div class="col-4 d-flex align-items-center">
                <div class="profileImage me-1">
                  <img alt="avatar" src="${item.profile_image_path}" class="rounded-circle">
                </div>
                <div class="text-ellipsis">`
        if (nameOrderInKorean.indexOf(locale) != -1) {
          temp_html += `${item.last_name} ${item.first_name}`
        } else {
          temp_html += `${item.first_name} ${item.last_name}`
        }
        temp_html += `</div>
              </div>
              <div class="col text-center flex-grow-1 text-ellipsis px-3">
                ${item.content}
              </div>
              <div class="col-2 text-center text-ellipsis">
                ${formatDate(item.create_date)}
              </div>
            </a>`
      })

      favoriteComments.innerHTML = temp_html;

      // make_pagination_by_func(page, count, func_name, limit = 10)
      if (data.count > 0) favoriteComments_pagination.innerHTML = make_pagination_by_func(page, data.count, "load_favoriteComments", 4)
    }
  </script>
  <script>
    window.addEventListener('load', event => {
      load_wishList();
      load_myPosts();
      load_favoritePosts();
      load_favoriteComments();
    })
  </script>
  <!-- BEGIN PAGE LEVEL PLUGINS/CUSTOM SCRIPTS -->
</body>

</html>